---

- name: "Wait for SalesforceBundle results"
  debug:
    msg: "{{ SalesforceBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: SalesforceBundleResults
  until: SalesforceBundle is defined
  retries: 15
  delay: 30

- name: "Wait for CoreBundle results"
  debug:
    msg: "{{ CoreBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: CoreBundleResults
  until: CoreBundle is defined
  retries: 15
  delay: 30

- name: "Wait for BusinessBundle results"
  debug:
    msg: "{{ BusinessBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: BusinessBundleResults
  until: BusinessBundle is defined
  retries: 15
  delay: 30

- name: "Wait for AppBundle results"
  debug:
    msg: "{{ AppBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: AppBundleResults
  until: AppBundle is defined
  retries: 15
  delay: 30

- name: "Wait for IntegrationBundle results"
  debug:
    msg: "{{ IntegrationBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: IntegrationBundleResults
  until: IntegrationBundle is defined
  retries: 15
  delay: 30

- name: "Wait for ModuleBundle results"
  debug:
    msg: "{{ ModuleBundle | default('KO') | regex_search(exp) }}"
  vars:
    exp: "OK \\(\\d+ tests, \\d+ assertions\\)"
  register: ModuleBundleResults
  until: ModuleBundle is defined
  retries: 15
  delay: 30

- name: "Final results"
  block:
  - debug:
      msg: "SalesforceBundle: {{ SalesforceBundleResults | default('KO') }}"
  - debug:
      msg: "IntegrationBundle: {{ IntegrationBundleResults | default('KO') }}"
  - debug:
      msg: "AppBundle: {{ AppBundleResults | default('KO') }}"
  - debug:
      msg: "BusinessBundle: {{ BusinessBundleResults | default('KO') }}"
  - debug:
      msg: "CoreBundle: {{ CoreBundleResults | default('KO') }}"
  - debug:
      msg: "ModuleBundle: {{ ModuleBundleResults | default('KO') }}"