---

- name: "Wait for {{ item }} slot"
  docker_container:
    name: "phpunit-cache"
    image: redis:32bit
    detach: no
    command: "redis-cli -h {{ redisHost }} -p {{ redisPort }} -a {{ redisPass}} --no-auth-warning GET {{ awx_workflow_job_name | default('wf') }}{{ awx_workflow_job_id | default('00') }}{{ item }}"
  register: "redis_container_{{ item }}"
  until: "redis_container_{{ item }}.ansible_facts.docker_container.Output is defined"
  retries: 15
  delay: 1
  loop:
  - app

- name: "Wait for {{ item }} slot"
  docker_container:
    name: "phpunit-cache"
    image: redis:32bit
    detach: no
    command: "redis-cli -h {{ redisHost }} -p {{ redisPort }} -a {{ redisPass}} --no-auth-warning GET {{ awx_workflow_job_name | default('wf') }}{{ awx_workflow_job_id | default('00') }}{{ item }}"
  register: "redis_container_{{ item }}"
  until: "redis_container_{{ item }}.ansible_facts.docker_container.Output is defined"
  retries: 15
  delay: 1
  loop:
  - module

- name: "Wait for {{ item }} slot"
  docker_container:
    name: "phpunit-cache"
    image: redis:32bit
    detach: no
    command: "redis-cli -h {{ redisHost }} -p {{ redisPort }} -a {{ redisPass}} --no-auth-warning GET {{ awx_workflow_job_name | default('wf') }}{{ awx_workflow_job_id | default('00') }}{{ item }}"
  register: "redis_container_{{ item }}"
  until: "redis_container_{{ item }}.ansible_facts.docker_container.Output is defined"
  retries: 15
  delay: 1
  loop:
  - appController

- name: "Wait for {{ item }} slot"
  docker_container:
    name: "phpunit-cache"
    image: redis:32bit
    detach: no
    command: "redis-cli -h {{ redisHost }} -p {{ redisPort }} -a {{ redisPass}} --no-auth-warning GET {{ awx_workflow_job_name | default('wf') }}{{ awx_workflow_job_id | default('00') }}{{ item }}"
  register: "redis_container_{{ item }}"
  until: "redis_container_{{ item }}.ansible_facts.docker_container.Output is defined"
  retries: 15
  delay: 1
  loop:
  - integration

- name: "Final results"
  debug:
    msg: "{{ item }}: {{ redis_container_{{ item }}.ansible_facts.docker_container.Output | default('KO') }}"
  loop:
  - app
  - module
  - appController
  - integration